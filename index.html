<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Echoes of Hope</title>
<style>
  body { margin:0; background:black; overflow:hidden; }
  canvas { display:block; margin:auto; background:#111; }
</style>
</head>
<body>

<canvas id="game" width="800" height="450"></canvas>

<script>
/* ================= BASE ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

/* ================= ESTADOS ================= */
let gameState = "menu"; // menu, game, boss, end
let cameraX = 0;

/* ================= PLAYER ================= */
let player = {
  x: 100, y: 330,
  w: 20, h: 20,
  life: 100,
  fury: false,
  speed: 2,
  attack: 10
};

/* ================= DOG ================= */
let dog = {
  x: 70, y: 340,
  alive: true
};

/* ================= ZUMBIS ================= */
let zombies = [];
function spawnZombie() {
  zombies.push({ x: cameraX + 900, y: 330, life: 30 });
}

/* ================= BOSS ================= */
let boss = {
  x: 1200, y: 280,
  w: 60, h: 80,
  life: 300,
  active: false
};

/* ================= TIROS ================= */
let bullets = [];

/* ================= LOOP ================= */
function update() {
  if (gameState === "menu") {
    if (keys["Enter"]) gameState = "game";
    drawMenu();
    requestAnimationFrame(update);
    return;
  }

  if (gameState === "game") updateGame();
  if (gameState === "boss") updateBoss();
  if (gameState === "end") drawEnd();

  requestAnimationFrame(update);
}

/* ================= GAME ================= */
function updateGame() {
  cameraX += player.speed;

  if (keys[" "]) {
    bullets.push({ x: player.x + 20, y: player.y + 10 });
  }

  bullets.forEach(b => b.x += 5);

  if (Math.random() < 0.02) spawnZombie();

  zombies.forEach(z => {
    z.x -= 1;
    if (z.x < player.x + 20 && z.x > player.x) {
      player.life -= 0.1;
    }
  });

  bullets.forEach(b => {
    zombies.forEach(z => {
      if (b.x > z.x && b.x < z.x + 20) {
        z.life -= player.attack;
      }
    });
  });

  zombies = zombies.filter(z => z.life > 0 && z.x > cameraX - 50);

  if (cameraX > 1000) {
    gameState = "boss";
    boss.active = true;
  }

  drawGame();
}

/* ================= BOSS ================= */
function updateBoss() {
  if (boss.life > 150 && dog.alive) {
    dog.alive = false;
    player.fury = true;
    player.attack = 30;
    player.speed = 3;
  }

  if (keys[" "]) {
    boss.life -= player.attack * 0.1;
  }

  if (boss.life <= 0) gameState = "end";

  drawBoss();
}

/* ================= DRAW ================= */
function drawGame() {
  ctx.clearRect(0,0,800,450);

  // fundo
  ctx.fillStyle = "#1b1b1b";
  ctx.fillRect(0,0,800,450);

  // prédios
  ctx.fillStyle = "#2e2e2e";
  for (let i=0;i<20;i++) {
    ctx.fillRect((i*200 - cameraX*0.3)%1600,150,80,200);
  }

  // chão
  ctx.fillStyle="#333";
  ctx.fillRect(0,350,800,100);

  // player
  ctx.fillStyle = player.fury ? "red" : "white";
  ctx.fillRect(player.x, player.y, player.w, player.h);

  // dog
  if (dog.alive) {
    ctx.fillStyle="brown";
    ctx.fillRect(dog.x, dog.y, 15, 10);
  }

  // zombies
  ctx.fillStyle="green";
  zombies.forEach(z => ctx.fillRect(z.x-cameraX, z.y, 20, 20));

  // bullets
  ctx.fillStyle="yellow";
  bullets.forEach(b => ctx.fillRect(b.x-cameraX, b.y, 5, 2));

  // HUD
  ctx.fillStyle="white";
  ctx.fillText("Vida: "+Math.floor(player.life),10,20);
}

function drawBoss() {
  drawGame();

  ctx.fillStyle="darkred";
  ctx.fillRect(boss.x-cameraX, boss.y, boss.w, boss.h);

  ctx.fillStyle="white";
  ctx.fillText("BOSS VIDA: "+Math.floor(boss.life), 300, 40);
}

function drawMenu() {
  ctx.fillStyle="black";
  ctx.fillRect(0,0,800,450);
  ctx.fillStyle="white";
  ctx.font="30px monospace";
  ctx.fillText("ECHOES OF HOPE",260,200);
  ctx.font="16px monospace";
  ctx.fillText("Pressione ENTER para começar",260,240);
}

function drawEnd() {
  ctx.fillStyle="black";
  ctx.fillRect(0,0,800,450);
  ctx.fillStyle="white";
  ctx.font="18px monospace";

  let text = [
    "A cidade caiu.",
    "Seu companheiro se foi.",
    "Mas a humanidade resiste.",
    "",
    "Jogo criado por:",
    "Jonathan Pereira"
  ];

  text.forEach((t,i)=>{
    ctx.fillText(t, 250, 150 + i*30);
  });
}

update();
</script>
</body>
</html>

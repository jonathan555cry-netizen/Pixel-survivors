<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Echoes After Pandemic</title>
<style>
body{margin:0;background:#000;display:flex;justify-content:center;align-items:center;height:100vh}
canvas{image-rendering:pixelated;border:3px solid #333}
</style>
</head>
<body>

<canvas id="game" width="640" height="480"></canvas>

<script>
/* ================= CONFIG ================= */
const c=document.getElementById("game"),ctx=c.getContext("2d");
const TILE=32;
const keys={};
document.addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
document.addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

/* ================= MAPA DA ARENA ================= */
const map=[
[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
[1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1],
[1,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,1],
[1,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,1],
[1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1],
[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

/* ================= ESTADO ================= */
let state="game"; // game | cutscene | credits | gameover
let cutText="",cutChar=0,scrollY=500;

/* ================= PLAYER ================= */
const player={x:TILE*2,y:TILE*2,life:100,speed:2};

/* ================= BOSS ================= */
const boss={
  x:320,y:160,
  life1:200,
  life2:200,
  spawn:120,
  shoot:40
};

let zombies=[],bullets=[],enemyShots=[];

/* ================= SPAWN ZUMBIS ================= */
function spawnZombie(){
  zombies.push({
    x:boss.x+Math.random()*40-20,
    y:boss.y+Math.random()*40-20,
    life:30,
    atk:0
  });
}

/* ================= TILE DRAW ================= */
function drawTile(t,x,y){
  if(t===0){ctx.fillStyle="#2e7d32";ctx.fillRect(x,y,32,32);}
  if(t===1){ctx.fillStyle="#1b5e20";ctx.fillRect(x,y,32,32);}
  if(t===4){
    ctx.fillStyle="#444";ctx.fillRect(x,y,32,32);
    ctx.fillStyle="#666";ctx.fillRect(x+6,y+18,6,6);
    ctx.fillRect(x+18,y+22,6,6);
  }
}

/* ================= COLLISION ================= */
function canMove(nx,ny){
  const cx=Math.floor(nx/TILE),cy=Math.floor(ny/TILE);
  return map[cy][cx]!==1;
}

/* ================= UPDATE ================= */
function update(){
  if(state==="gameover"){
    if(keys["enter"])location.reload();
    return;
  }

  if(state==="cutscene"){
    if(cutChar<cutText.length)cutChar+=0.5;
    if(keys["enter"]){state="credits";keys["enter"]=false;}
    return;
  }

  if(state==="credits"){
    scrollY-=0.5;
    return;
  }

  /* ===== PLAYER ===== */
  let nx=player.x,ny=player.y;
  if(keys["w"])ny-=player.speed;
  if(keys["s"])ny+=player.speed;
  if(keys["a"])nx-=player.speed;
  if(keys["d"])nx+=player.speed;
  if(canMove(nx,ny)){player.x=nx;player.y=ny;}

  if(keys[" "]){
    bullets.push({x:player.x,y:player.y});
    keys[" "]=false;
  }
  bullets.forEach(b=>b.y-=6);

  /* ===== BOSS MOVEMENT ===== */
  const dx=player.x-boss.x,dy=player.y-boss.y,d=Math.hypot(dx,dy);
  boss.x+=dx/d*0.4;
  boss.y+=dy/d*0.4;

  /* ===== BOSS ATAQUES ===== */
  boss.spawn--;
  if(boss.spawn<=0){
    spawnZombie();
    boss.spawn=120;
  }

  boss.shoot--;
  if(boss.shoot<=0){
    enemyShots.push({x:boss.x,y:boss.y,vx:dx/d*4,vy:dy/d*4});
    boss.shoot=40;
  }

  /* ===== ZUMBIS ===== */
  zombies.forEach(z=>{
    const dx=player.x-z.x,dy=player.y-z.y,d=Math.hypot(dx,dy);
    z.x+=dx/d*0.3;
    z.y+=dy/d*0.3;
    if(d<18 && z.atk<=0){
      player.life-=8;
      z.atk=30;
    }
    if(z.atk>0)z.atk--;
  });

  /* ===== PROJÉTEIS ===== */
  enemyShots.forEach((s,i)=>{
    s.x+=s.vx;s.y+=s.vy;
    if(Math.abs(s.x-player.x)<10){
      player.life-=10;
      enemyShots.splice(i,1);
    }
  });

  bullets.forEach((b,i)=>{
    if(Math.abs(b.x-boss.x)<20){
      if(boss.life1>0)boss.life1-=10;
      else boss.life2-=10;
      bullets.splice(i,1);
    }
  });

  if(player.life<=0){
    player.life=0;
    state="gameover";
  }

  if(boss.life1<=0 && boss.life2<=0){
    state="cutscene";
    cutText="O monstro caiu.\nO silêncio voltou.\nMas o mundo jamais será o mesmo.";
    cutChar=0;
  }
}

/* ================= DRAW ================= */
function draw(){
  ctx.clearRect(0,0,640,480);

  for(let y=0;y<map.length;y++){
    for(let x=0;x<map[y].length;x++){
      drawTile(map[y][x],x*TILE,y*TILE);
    }
  }

  // PLAYER
  ctx.fillStyle="#ffd180";
  ctx.fillRect(player.x+8,player.y+6,16,20);

  // BOSS
  ctx.fillStyle="#7b1e1e";
  ctx.fillRect(boss.x-20,boss.y-20,40,40);

  // ZUMBIS
  zombies.forEach(z=>{
    ctx.fillStyle="#3fa34d";
    ctx.fillRect(z.x+8,z.y+8,16,16);
  });

  // SHOTS
  enemyShots.forEach(s=>{
    ctx.fillStyle="#aaa";
    ctx.fillRect(s.x,s.y,4,4);
  });
  bullets.forEach(b=>{
    ctx.fillStyle="#ff0";
    ctx.fillRect(b.x+14,b.y,4,4);
  });

  // HUD
  ctx.fillStyle="#fff";
  ctx.fillText("Vida: "+player.life,10,20);
  ctx.fillText("Boss 1: "+boss.life1,200,20);
  ctx.fillText("Boss 2: "+boss.life2,350,20);

  if(state==="cutscene"){
    ctx.fillStyle="rgba(0,0,0,0.8)";
    ctx.fillRect(0,0,640,480);
    ctx.fillStyle="#fff";
    ctx.fillText(cutText.substring(0,cutChar),100,240);
  }

  if(state==="credits"){
    ctx.fillStyle="#000";
    ctx.fillRect(0,0,640,480);
    ctx.fillStyle="#fff";
    ctx.fillText("Echoes After Pandemic",200,scrollY);
    ctx.fillText("Criado por Jonathan Pereira",180,scrollY+40);
    ctx.fillText("Obrigado por jogar",220,scrollY+80);
  }

  if(state==="gameover"){
    ctx.fillStyle="rgba(0,0,0,0.8)";
    ctx.fillRect(0,0,640,480);
    ctx.fillStyle="#f00";
    ctx.fillText("GAME OVER",270,220);
    ctx.fillStyle="#fff";
    ctx.fillText("Pressione ENTER",250,260);
  }
}

/* ================= LOOP ================= */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
